---
product: campaign
title: 添付ファイル付きトランザクションメールの送信
description: Adobe Campaign を使用して、個々の添付ファイルやパーソナライズされた添付ファイルを含むトランザクションメールを送信する方法を説明します。
feature: Transactional Messaging, Message Center
exl-id: 755d2364-f6c4-4943-97e8-3ed52a0f2665
source-git-commit: ad6f3f2cf242d28de9e6da5cec100e096c5cbec2
workflow-type: tm+mt
source-wordcount: '670'
ht-degree: 98%

---

# ユースケース：添付ファイルを含んだトランザクションメールの送信 {#transactional-email-with-attachments}



このユースケースの目的は、アウトバウンドの送信時にメール添付ファイルをオンザフライで追加することです。

## 主な手順 {#key-steps}

このシナリオでは、個人向け添付ファイルやパーソナライズされた添付ファイルを含んだトランザクションメールを送信する方法について説明します。添付ファイルは、トランザクションメッセージのサーバーに事前にアップロードされるのではなく、オンザフライで生成されます。

顧客のインタラクションや詳細を記録する場合は、プロセスの最後にこの情報を顧客に送り返すことが必要になる場合があります。例えば、この情報を含めた PDF ファイルをメールに添付したりします。

このシナリオの主な手順は次のとおりです。

1. 顧客が Web サイトにアクセスし、購入する商品を検索します。
1. 顧客が目的の商品を選択し、いくつかのオプションをカスタマイズします。
1. 顧客がトランザクションを完了します。
1. その顧客にトランザクションの内容を確認するメールが送信されます。PII（個人を特定できる情報）をメールで送信することは推奨されないので、安全な PDF が生成され、メールに添付されます。
1. 顧客がメールと関連データを含む添付ファイルを受け取ります。

このシナリオでは、添付ファイルは事前に作成されるのではなく、送信メールにオンザフライで追加されます。それにより、次のような利点があります。

* この場合、添付ファイルのコンテンツをパーソナライズできます。
* また、上記のシナリオ例のように添付ファイルがトランザクションに関連する場合には、顧客のプロセスの間に生成される動的データを添付ファイルに含めることもあります。
* PDF ファイルを添付すると、PDF ファイルを暗号化して HTTPS 経由で送信できるので、セキュリティが最適化されます。

## レコメンデーションとガードレール {#important-notes}

パフォーマンスの問題を回避するために、メールに含める画像のサイズは 100 KB 以下にする必要があります。この制限は、デフォルトで設定されており、`NmsDelivery_MaxDownloadedImageSize` オプションから変更できます。ただし、アドビでは、メール配信で大きな画像を使用しないことを強くお勧めします。

また、アドビでは、添付ファイルのサイズと数を制限することもお勧めします。デフォルトでは、メールに添付ファイルとして追加できるファイルは 1 つだけです。このしきい値は、`NmsDelivery_MaxRecommendedAttachments` オプションから設定できます。

詳しくは、[Campaign Classic のオプションのリスト](../../installation/using/configuring-campaign-options.md#delivery)を参照してください。

このシナリオを実装する前に、次のガイドラインをよくお読みください。

* トランザクションメッセージのインスタンスを使用して、ファイルやデータの保存、エクスポート、アップロードを行うことはできません。イベントデータおよび関連情報にのみ使用できます。このインスタンスを、ファイルストレージシステムと考えないでください。
* アドビの外部のトランザクションメッセージインスタンスやサーバーに直接アクセスすることはできないため、これらのサーバーにそのようなファイルをプッシュする標準的な方法はありません（FTP アクセスはありません）。
* トランザクションメッセージインスタンスのディスク領域に何らかのファイルを格納することは契約に沿ったものではなく、添付ファイルも例外ではありません。
* 別のオンラインディスクシステムでこれらのファイルをホストする必要があります。このシステムに FTP 経由でアクセスできることに加え、ファイルの書き込みと削除をおこなえる必要があります。

>[!NOTE]
>
>パフォーマンスの問題を回避するために、1 つのメールに複数の添付ファイルを含めないことをお勧めします。推奨しきい値は、[Campaign Classic オプションのリスト](../../installation/using/configuring-campaign-options.md#delivery)から設定できます。

## 実装 {#implementation}

次のダイアグラムに、このシナリオを実装する際の様々な手順を示します。

![](assets/message-center-uc1.png)

メール添付ファイルをオンザフライでトランザクションメッセージに追加するには、次の手順に従います。

1. 添付ファイルのデザインから開始します。詳しくは、[Campaign v8 ドキュメント &#x200B;](https://experienceleague.adobe.com/docs/campaign/campaign-v8/send/emails/attaching-files.html?lang=ja#attach-a-personalized-file){target="_blank"} を参照してください。

   こうすることで、実行インスタンスでホストされていなくても、ファイルをメールに添付できます。

1. SOAP メッセージトリガーを介してメールを送信できます。SOAP 呼び出しには、URL パラメーター（attachmentURL）があります。

   SOAP リクエストについて詳しくは、[イベントの説明](../../message-center/using/event-description.md)を参照してください。

1. メールをデザインするときに、「**[!UICONTROL 添付ファイル]**」をクリックします。

1. **[!UICONTROL 添付ファイルの定義]**&#x200B;画面で、SOAP 添付ファイルパラメーターを入力します。

   ```
   <%= rtEvent.ctx.attachmentUrl %>
   ```

1. メッセージの処理中、システムによってリモートの場所（サードパーティサーバー）からファイルが取得され、個々のメッセージに添付されます。

   このパラメーターには変数を使用できるので、目的のファイルの完全な形のリモート URL 変数を指定し、SOAP 呼び出しを介して送信できます。

   ![](assets/message-center-uc2.png)
