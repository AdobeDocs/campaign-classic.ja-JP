---
product: campaign
title: 環境の複製
description: 環境の複製
audience: production
content-type: reference
topic-tags: data-processing
exl-id: 2c933fc5-1c0a-4c2f-9ff2-90d09a79c55a
source-git-commit: 98d646919fedc66ee9145522ad0c5f15b25dbf2e
workflow-type: tm+mt
source-wordcount: '1296'
ht-degree: 3%

---

# 環境の複製{#duplicating-environments}

## はじめに {#introduction}

### 概要 {#overview}

>[!IMPORTANT]
>
>サーバーとデータベース（ホスト環境）にアクセスできない場合、以下に説明する手順は実行できません。 Adobeに連絡。

Adobe Campaignを使用するには、1つ以上の環境をインストールして設定する必要があります。開発、テスト、実稼動前、実稼動環境など

各環境には1つのAdobe Campaignインスタンスが含まれ、各Adobe Campaignインスタンスは1つ以上のデータベースにリンクされています。 アプリケーションサーバーは、1つ以上のプロセスを実行できます。これらのほとんどすべては、インスタンスデータベースに直接アクセスできます。

この節では、Adobe Campaign環境の複製に適用するプロセスについて詳しく説明します。例えば、ソース環境をターゲット環境に復元する場合に、2つの同じ作業環境を作成する場合に使用します。

それには、次の手順に従います。

1. ソース環境内のすべてのインスタンス上にデータベースのコピーを作成します。
1. ターゲット環境のすべてのインスタンス上で、これらのコピーを復元する
1. 起動する前に、ターゲット環境で&#x200B;**nms:freezeInstance.js**&#x200B;焼灼スクリプトを実行します。

   このプロセスは、サーバーとその設定には影響しません。

   >[!NOTE]
   >
   >Adobe Campaignのコンテキストでは、 **焼灼**&#x200B;は、外部との対話をすべてのプロセスを停止するアクションを組み合わせます。ログ、トラッキング、配信、キャンペーンワークフローなど\
   >この手順は、（1回は公称環境から、もう1回は複製環境から）メッセージを複数回配信しないようにするために必要です。

   >[!IMPORTANT]
   >
   >1つの環境に複数のインスタンスを含めることができます。 各Adobe Campaignインスタンスには、ライセンス契約が適用されます。 使用許諾契約を確認して、使用できる環境の数を確認します。\
   >以下の手順を実行すると、インストールした環境やインスタンスの数に影響を与えることなく、環境を転送できます。

### {#before-you-start}を起動する前に

>[!IMPORTANT]
>
>転送プロセスを開始する前に、ソース環境とターゲット環境のすべてのインスタンスに対して、データベースの完全バックアップを実行することを強くお勧めします。 この方法で問題が発生した場合は、バックアップを復元し、初期設定に戻すことができます。

このプロセスを機能させるには、ソース環境とターゲット環境で同じ数のインスタンス、同じ目的（マーケティングインスタンス、配信インスタンス）、類似した設定が必要です。 技術的な設定は、ソフトウェアの前提条件に従う必要があります。 両方の環境に同じコンポーネントをインストールする必要があります。

## 実装 {#implementation}

### 転送手順{#transfer-procedure}

この節では、ケーススタディを使用して、ソース環境をターゲット環境に移行する際に必要な手順を説明します。ここでの目的は、実稼動環境（**prod**&#x200B;インスタンス）を開発環境（**dev**&#x200B;インスタンス）に復元し、「ライブ」プラットフォームにできるだけ近いコンテキストで動作させることです。

次の手順は慎重に実行する必要があります。ソース環境データベースをコピーする際に、一部のプロセスが進行中である可能性があります。 注意点（下の手順3）では、メッセージが2回送信されるのを防ぎ、データの一貫性を維持します。

>[!IMPORTANT]
>
>* 次の手順は、PostgreSQL言語で有効です。 SQL言語が異なる場合(Oracleなど)は、SQLクエリを適応させる必要があります。
>* 以下のコマンドは、PostgreSQLの下の&#x200B;**prod**&#x200B;インスタンスと&#x200B;**dev**&#x200B;インスタンスのコンテキスト内に適用されます。

>



### 手順1 — ソース環境（実稼動）データのバックアップを作成する{#step-1---make-a-backup-of-the-source-environment--prod--data}

データベースのコピー

まず、すべてのソース環境データベースをコピーします。 操作はデータベースエンジンに依存し、データベース管理者がおこないます。

PostgreSQLでは、コマンドは次のようになります。

```
pg_dump mydatabase > mydatabase.sql
```

### 手順2 — ターゲット環境設定（開発）を書き出す{#step-2---export-the-target-environment-configuration--dev-}

ほとんどの設定要素は、環境ごとに異なります。外部アカウント（ミッドソーシング、ルーティングなど）、技術オプション（プラットフォーム名、データベースID、Eメールアドレス、デフォルトURLなど）。

ソースデータベースをターゲットデータベースに保存する前に、ターゲット環境（開発環境）の設定を書き出す必要があります。 これをおこなうには、次の2つのテーブルの内容をエクスポートします。**xtkoption**&#x200B;と&#x200B;**nmsextaccount**。

この書き出しを使用すると、開発環境の設定を維持し、開発データ（ワークフロー、テンプレート、Webアプリケーション、受信者など）のみを更新できます。

これをおこなうには、次の2つの要素に対してパッケージのエクスポートを実行します。

* **xtk:option**&#x200B;テーブルを「options_dev.xml」ファイルにエクスポートします。この際、次の内部名を持つレコードは含まれません。&#39;WdbcTimeZone&#39;、&#39;NmsServer_LastPostUpgrade&#39;および&#39;NmsBroadcast_RegexRules&#39;。
* 「extaccount_dev.xml」ファイルで、IDが0(@id &lt;> 0)でないすべてのレコードの&#x200B;**nms:extAccount**&#x200B;テーブルを書き出します。

エクスポートするオプション/アカウントの数が、各ファイルにエクスポートする行数と等しいことを確認します。

>[!NOTE]
>
>パッケージエクスポートでエクスポートする行の数は1,000行です。 オプションまたは外部アカウントの数が1,000を超える場合は、複数のエクスポートを実行する必要があります。
> 
>詳しくは、[こちらの節](../../platform/using/working-with-data-packages.md#exporting-packages)を参照してください。

>[!NOTE]
>
>nmsextaccountテーブルをエクスポートすると、外部アカウントに関連するパスワード（例えば、ミッドソーシング、Message Centerの実行、SMPP、IMSおよびその他の外部アカウントのパスワード）はエクスポートされません。 外部アカウントを環境に再びインポートした後で再入力する必要が生じる場合があるので、正しいパスワードに事前にアクセスできることを確認してください。

### 手順3 — ターゲット環境（開発）を停止します{#step-3---stop-the-target-environment--dev-}

すべてのターゲット環境サーバーでAdobe Campaignプロセスを停止する必要があります。 この操作は、オペレーティングシステムによって異なります。

すべてのプロセスを停止するか、データベースに書き込むプロセスのみを停止できます。

すべてのプロセスを停止するには、次のコマンドを使用します。

* Windowsの場合：

   ```
   net stop nlserver6
   ```

* Linuxの場合：

   ```
   /etc/init.d/nlserver6 stop
   ```

次のコマンドを使用して、すべてのプロセスが停止したことを確認します。

```
nlserver pdump
```

>[!NOTE]
>
>Windowsでは、**webmdl**&#x200B;プロセスは、他の操作に影響を与えることなくアクティブなままです。

また、実行中のシステムプロセスがないことも確認できます。

それには、次の手順に従います。

* Windowsの場合：**タスクマネージャー**&#x200B;を開き、**nlserver.exe**&#x200B;プロセスがないことを確認します。
* Linuxの場合：**ps auxを実行します。 | grep nlserver**&#x200B;コマンドを実行し、**nlserver**&#x200B;プロセスがないことを確認します。

### 手順4 — ターゲット環境（開発環境）のデータベースを復元する{#step-4---restore-the-databases-in-the-target-environment--dev-}

ターゲット環境でソース・データベースをリストアするには、次のコマンドを使用します。

```
psql mydatabase < mydatabase.sql
```

### 手順5 — ターゲット環境（開発）の焼灼{#step-5---cauterize-the-target-environment--dev-}

誤動作を防ぐために、配信の送信とワークフローの実行に関連するプロセスを、ターゲット環境がアクティブ化されたときに自動的に実行しないようにする必要があります。

これをおこなうには、次のコマンドを実行します。

```
nlserver javascript nms:freezeInstance.js -instance:<dev> -arg:run
```

### 手順6 - {#step-6---check-cauterization}の警告を確認する

1. IDが0に設定されているのが配信パートのみであることを確認します。

   ```
   SELECT * FROM neolane.nmsdeliverypart;
   ```

1. 配信ステータスが正しく更新されていることを確認します。

   ```
   SELECT iState, count(*) FROM neolane.nmsdelivery GROUP BY iState;
   ```

1. ワークフローのステータスが正しく更新されていることを確認します。

   ```
   SELECT iState, count(*) FROM neolane.xtkworkflow GROUP BY iState;
   SELECT iStatus, count(*) FROM neolane.xtkworkflow GROUP BY iStatus;
   ```

### 手順7 — ターゲット環境のWebプロセス（開発）を再起動します{#step-7---restart-the-target-environment-web-process--dev-}

ターゲット環境で、すべてのサーバーのAdobe Campaignプロセスを再起動します。

>[!NOTE]
>
>**dev**&#x200B;環境でAdobe Campaignを再起動する前に、次の安全手順を追加で適用できます。**web**&#x200B;モジュールのみを起動します。
>  
>これをおこなうには、インスタンスの設定ファイル(**config-dev.xml**)を編集し、各モジュール（mta、statなど）のautoStart=&quot;true&quot;オプションの前に「_」文字を追加します。

次のコマンドを実行して、Webプロセスを開始します。

```
nlserver start web
```

次のコマンドを使用して、Webプロセスのみが開始したことを確認します。

```
nlserver pdump
```

クライアントコンソール機能へのアクセス権を確認します。

### 手順8 — ターゲット環境（開発）にオプションと外部アカウントを読み込む{#step-8---import-options-and-external-accounts-into-the-target-environment--dev-}

>[!IMPORTANT]
>
>この手順では、Webプロセスのみを開始する必要があります。 そうでない場合は、続行する前に他の実行中のプロセスを停止します

特に、読み込む前に、複数行のファイルの値を確認します(例：オプションテーブルおよび外部アカウントテーブルの配信またはミッドソーシングアカウントの「NmsTracking_Pointer」)

ターゲット環境データベース（開発環境）から設定を読み込むには、次の手順を実行します。

1. データベースの管理コンソールを開き、IDが0(@id &lt;> 0)でない外部アカウント(table nms:extAccount)をパージします。
1. Adobe Campaignコンソールで、パッケージの読み込み機能で以前に作成したoptions_dev.xmlパッケージを読み込みます。

   **[!UICONTROL 管理/プラットフォーム/オプション]**&#x200B;ノードで、オプションが実際に更新されていることを確認します。

1. Adobe Campaignコンソールで、パッケージのインポート機能を使用して作成済みのextaccount_dev.xmlをインポートします。

   **[!UICONTROL 管理/プラットフォーム/外部アカウント]**&#x200B;で、外部データベースが実際にインポートされたことを確認します。

### 手順9 — すべてのプロセスを再起動し、ユーザーを変更する（開発） {#step-9---restart-all-processes-and-change-users--dev-}

Adobe Campaignプロセスを開始するには、次のコマンドを使用します。

* Windowsの場合：

   ```
   net start nlserver6
   ```

* Linuxの場合：

   ```
   /etc/init.d/nlserver6 start
   ```

次のコマンドを使用して、プロセスが開始されたことを確認します。

```
nlserver pdump
```

ユーザーを変更して、開発プラットフォームに既に存在するユーザーを見つけます。
